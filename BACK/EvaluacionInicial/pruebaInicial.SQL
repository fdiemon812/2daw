-- FUERA TABLAS

DROP TABLE MEDICO;
DROP TABLE PACIENTE;
DROP TABLE RECIBE;


CREATE OR REPLACE TABLE MEDICO(

    IDMEDICO NUMBER(3) PRIMARY KEY,
    NIF VARCHAR2(9) UNIQUE,
    NOMBRE VARCHAR2(20),
    ESPECIALIDAD VARCHAR2(20)


);

ALTER TABLE MEDICO ADD (
    CONSTRAINT CONS_ESPECIALIDADES CHECK (ESPECIALIDAD IN('TRAUMA', 'GENERAL', 'CARDIO'))
    );




CREATE TABLE PACIENTE(
    IDPACIENTE NUMBER(4) PRIMARY KEY,
    NOMBREPACIENTE VARCHAR2(20),
    EDAD NUMBER(3) CHECK ( EDAD>0 AND EDAD<150 ),
    TELEFONO NUMBER(9)


);


CREATE table RECIBE_CONSULTA(
    FECHA DATE,
    IDMEDICO NUMBER(3) REFERENCES MEDICO,
    IDPACIENTE NUMBER(4) REFERENCES PACIENTE,
    TRATAMIENTO VARCHAR2(30), 
    PRIMARY KEY(IDMEDICO, IDPACIENTE, FECHA)

);


INSERT INTO MEDICO VALUES(001,'11111111A', 'JUAN', 'CARDIO');
INSERT INTO MEDICO VALUES(002,'21111111A', 'PACO', 'GENERAL');
INSERT INTO MEDICO VALUES(003,'31111111A', 'MARA', 'TRAUMA');
INSERT INTO MEDICO VALUES(004,'41111111A', 'ANA', 'GENERAL');
INSERT INTO MEDICO VALUES(005,'51111111A', 'FATIMA', 'CARDIO');
INSERT INTO MEDICO VALUES(006,'61111111A', 'IVAN', 'CARDIO');
INSERT INTO MEDICO VALUES(007,'71111111A', 'CARLOS', 'GENERAL');
INSERT INTO MEDICO VALUES(008,'81111111A', 'RAUL', 'TRAUMA');
INSERT INTO MEDICO VALUES(009,'91111111A', 'SERGIO', 'CARDIO');
INSERT INTO MEDICO VALUES(010,'2222111A', 'LAURA', 'TRAUMA');


INSERT INTO PACIENTE VALUES(0001, 'MANOLO', 25, 166666666);
INSERT INTO PACIENTE VALUES(0002, 'LUCIUS', 55, 266666666);
INSERT INTO PACIENTE VALUES(0003, 'HARRY', 95, 636666666);
INSERT INTO PACIENTE VALUES(0004, 'RON', 115, 664666666);
INSERT INTO PACIENTE VALUES(0005, 'HERMIONE', 2, 566666666);
INSERT INTO PACIENTE VALUES(0006, 'SNAPE', 15, 667666666);
INSERT INTO PACIENTE VALUES(0007, 'NEVILLE', 25, 866666666);
INSERT INTO PACIENTE VALUES(0008, 'LUNA', 36, 666966666);
INSERT INTO PACIENTE VALUES(0009, 'MALFOY', 25, 116666666);
INSERT INTO PACIENTE VALUES(0010, 'GIPSY', 22, 622666666);



INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('01-01-01', 'DD-MM-YY'),001,0001, '2 LACASITOS AL DIA');

UPDATE RECIBE_CONSULTA SET FECHA= TO_DATE('01-01-01 10:30', 'DD-MM-YY HH:MI') 
WHERE IDMEDICO=001 AND IDPACIENTE= 0001 AND FECHA=TO_DATE(TO_DATE('01-01-01', 'DD-MM-YY'));


INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('01-01-01 10:30', 'DD-MM-YY HH:MI'),001,0001, '2 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('02-01-01 10:30', 'DD-MM-YY HH:MI'),002,0001, '4 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('03-01-01 10:30', 'DD-MM-YY HH:MI'),003,0001, '5 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('04-01-01 10:30', 'DD-MM-YY HH:MI'),005,0002, '6 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('05-01-01 10:30', 'DD-MM-YY HH:MI'),006,0003, '100 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('06-01-01 10:30', 'DD-MM-YY HH:MI'),001,0004, '200 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('07-01-01 10:30', 'DD-MM-YY HH:MI'),007,0005, '259 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('08-01-01 10:30', 'DD-MM-YY HH:MI'),004,0006, '20 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('09-01-01 10:30', 'DD-MM-YY HH:MI'),008,0007, '28 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('10-01-01 10:30', 'DD-MM-YY HH:MI'),009,0008, '45 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('10-01-01 12:30', 'DD-MM-YY HH:MI'),001,0009, '15 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('10-01-01 11:30', 'DD-MM-YY HH:MI'),010,0010, '2456 LACASITOS AL DIA');

INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('01-01-01 10:30', 'DD-MM-YY HH:MI'),010,0001, '2 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('02-01-01 10:30', 'DD-MM-YY HH:MI'),004,0001, '4 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('03-01-01 10:30', 'DD-MM-YY HH:MI'),002,0001, '5 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('04-01-01 10:30', 'DD-MM-YY HH:MI'),008,0002, '6 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('05-01-01 10:30', 'DD-MM-YY HH:MI'),005,0003, '100 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('06-01-01 10:30', 'DD-MM-YY HH:MI'),002,0004, '200 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('07-01-01 10:30', 'DD-MM-YY HH:MI'),001,0005, '259 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('08-01-01 10:30', 'DD-MM-YY HH:MI'),007,0006, '20 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('09-01-01 10:30', 'DD-MM-YY HH:MI'),004,0007, '28 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('10-01-01 10:30', 'DD-MM-YY HH:MI'),010,0008, '45 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('10-01-01 12:30', 'DD-MM-YY HH:MI'),003,0009, '15 LACASITOS AL DIA');
INSERT INTO RECIBE_CONSULTA VALUES(TO_DATE('10-01-01 11:30', 'DD-MM-YY HH:MI'),009,0010, '2456 LACASITOS AL DIA');




DELETE RECIBE_CONSULTA WHERE IDMEDICO=001 AND IDPACIENTE=0001;
COMMIT;






--Pacientes entre 20 y 30 años

SELECT NOMBREPACIENTE FROM PACIENTE WHERE EDAD>=20 and EDAD<=30;


--NOMBRE DE LOS PACIENTES MAYORES DE 50 TRATADOS POR EL MEDICO 0001--
SELECT NOMBREPACIENTE FROM PACIENTE WHERE IDPACIENTE IN
(SELECT IDPACIENTE FROM RECIBE_CONSULTA WHERE IDMEDICO='001');


--CANTIDAD DE PACIENTES DISTINTOS QUE HA TRATADO CADA ESPECIALIDAD MEDICA ORDENADOS DE MAYOR A MENOR

SELECT COUNT(DISTINCT PACIENTE.IDPACIENTE), ESPECIALIDAD FROM PACIENTE, MEDICO, RECIBE_CONSULTA
WHERE PACIENTE.IDPACIENTE=RECIBE_CONSULTA.IDPACIENTE AND MEDICO.IDMEDICO=RECIBE_CONSULTA.IDMEDICO GROUP BY
ESPECIALIDAD ORDER BY COUNT(DISTINCT PACIENTE.IDPACIENTE) DESC ;



-- NOMBRE DE PACIENTE Y MEDICO, TRATADOS  POR LA ESPECIALIDAD DE TRAUMA ENTRE EL DIA 01 Y EL 30

SELECT NOMBREPACIENTE, NOMBRE, ESPECIALIDAD, FECHA FROM MEDICO, PACIENTE, RECIBE_CONSULTA
WHERE PACIENTE.IDPACIENTE=RECIBE_CONSULTA.IDPACIENTE AND MEDICO.IDMEDICO=RECIBE_CONSULTA.IDMEDICO AND ESPECIALIDAD='TRAUMA'
AND (EXTRACT(DAY FROM FECHA)<'30' and EXTRACT(DAY FROM FECHA)>'01') ;


-- NOMBRE DE PACIENTE, MEDICO Y FECHA. TRATADOS EN MAS DE UNA OCASIÓN POR LA ESPECIALIDAD DE TRAUMA ENTRE EL DIA 01 Y 30DE ENERO

SELECT NOMBREPACIENTE, NOMBRE, FECHA FROM MEDICO, PACIENTE, RECIBE_CONSULTA
WHERE PACIENTE.IDPACIENTE=RECIBE_CONSULTA.IDPACIENTE AND MEDICO.IDMEDICO=RECIBE_CONSULTA.IDMEDICO AND ESPECIALIDAD='TRAUMA'
AND (EXTRACT(DAY FROM FECHA)<'30' and EXTRACT(DAY FROM FECHA)>'01') AND PACIENTE.IDPACIENTE IN (
SELECT IDPACIENTE FROM RECIBE_CONSULTA GROUP BY IDPACIENTE HAVING COUNT(IDPACIENTE)>2);












